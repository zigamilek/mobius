server:
  host: 0.0.0.0
  port: 8080
  api_keys:
    - dev-local-key

providers:
  openai:
    api_key: ${ENV:OPENAI_API_KEY}
  gemini:
    api_key: ${ENV:GEMINI_API_KEY}
    base_url: https://generativelanguage.googleapis.com/v1beta/openai/

models:
  orchestrator: gpt-5-nano-2025-08-07
  fallbacks:
    - gemini-2.5-flash

# OpenAI-compatible API contract exposed to clients (for example Open WebUI).
api:
  public_model_id: mobius
  allow_provider_model_passthrough: false
  attribution:
    enabled: true
    include_model: true
    include_general: false
    template: "Answered by {display_name} (the {domain_label} specialist){model_suffix}."

specialists:
  prompts_directory: ./system_prompts
  auto_reload: true
  orchestrator_prompt_file: _orchestrator.md
  by_domain:
    general:
      model: gpt-5.2
      prompt_file: general.md
    health:
      model: gpt-5.2
      prompt_file: health.md
      display_name: The Coach
    parenting:
      model: gpt-5.2
      prompt_file: parenting.md
      display_name: The Parenting Coach
    relationships:
      model: gpt-5.2
      prompt_file: relationships.md
      display_name: The Counselor
    homelab:
      model: gpt-5.2
      prompt_file: homelab.md
      display_name: The Tinkerer
    personal_development:
      model: gpt-5.2
      prompt_file: personal_development.md
      display_name: The Mentor

runtime:
  inject_current_timestamp: true
  timezone: Europe/Ljubljana
  include_timestamp_in_routing: false

state:
  enabled: false
  database:
    dsn: ${ENV:MOBIUS_STATE_DSN}
    auto_migrate: true
    min_schema_version: "0003"
    max_schema_version: "0003"
    connect_timeout_seconds: 5
  projection:
    mode: one_way
    output_directory: ./data/state
  user_scope:
    policy: by_user
    anonymous_user_key: anonymous
  decision:
    enabled: true
    model: ""
    include_fallbacks: false
    facts_only: true
    strict_grounding: true
    max_user_chars: 3000
    max_assistant_chars: 3000
    max_json_retries: 1
    on_failure: footer_warning
  checkin:
    enabled: true
    max_wins: 3
    max_barriers: 3
    max_next_actions: 3
  memory:
    enabled: true
    max_tags: 8
    semantic_merge:
      enabled: true
      embedding_model: text-embedding-3-small
      verification_model: ""
      include_fallbacks: false
      candidate_limit: 8
      max_candidate_text_chars: 280
      max_json_retries: 1
      max_distance: 0.42
  retrieval:
    active_tracks_limit: 5
    recent_checkins_limit: 5
    recent_memory_cards_limit: 5

diagnostics:
  enabled: true
  endpoints:
    health: /healthz
    readiness: /readyz
    diagnostics: /diagnostics

logging:
  level: DEBUG
  output: console
  directory: ./data/logs
  filename: mobius.log
  daily_rotation: true
  retention_days: 7
  utc: true
  include_payloads: false
